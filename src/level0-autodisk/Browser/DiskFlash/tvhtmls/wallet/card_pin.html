<html>
<head>
	<title>Credit Card and PIN</title>
<DISPLAY noscroll skipback nologo nooptions noreconnectalert>
</head>
<script src="../wallet.js"></script>
<script>
var HideBillAndPIN = top.goToReview;  
function ChooseForm() {
var ccCardNumber=top.ccNum;
  if (HideBillAndPIN) {
      document.all.CheckboxPIN.style.visibility="hidden";
      document.all.ExpDate.style.posTop=240;
  } else {
    document.all.ExpDate.style.posTop=220;
    document.all.CheckboxPIN.style.visibility="visible";
  }
}
function CheckCardPinInput(form){
  var ccCardNumber=StripDashesAndSpaces(document.card_pin.cardnumber.value);
  var addComma = ", ";
  var fieldName = "";
  top.errorMessage = "";
  form.expmonth.value = TrimWhiteSpace(form.expmonth.value);
  if (form.cardnumber.value.length == 0){
		fieldName += "Card Number";
  }
  if (form.expmonth.value.length == 0) {
		if (fieldName != "") {fieldName += addComma;}
			fieldName += "Expiration Month";
  }
  if (form.expyear.value.length == 0) {
		if (fieldName != "") {fieldName += addComma;}
			fieldName += "Expiration Year";
  }
  if (!HideBillAndPIN){
		if (form.newpin.value.length == 0) {
			if (fieldName != "") {fieldName += addComma;}
			fieldName += "Type in Wallet PIN";
		}
		if (form.confirmpin.value.length == 0) {
			if (fieldName != "") {fieldName += addComma;}
			fieldName += "Re-type to confirm PIN";
		}
  }
  if (fieldName != "") {
			top.errorMessage = "You need to provide information for: " + fieldName + ". It's required to fulfill your request. ";
  } 
  if (ccCardNumber.length != 0) {
	  if (!isValidCardNum(ccCardNumber)){
			top.errorMessage += "You have typed in an incorrect credit card. Please try typing it again in the proper format, for example: 0000-0000-0000-0000. ";
	  } else  if (!CheckCreditCardLengthAndPrefix(ccCardNumber)){
			top.errorMessage += "We only accept Visa or Master Card for purchases. Please type in a valid Visa or Mastercard number. ";
	  }
  }
	if ((document.card_pin.expmonth.value != "") && (document.card_pin.expyear.value != "") && (!IsDateOK(document.card_pin.expmonth.value,document.card_pin.expyear.value))){
			top.errorMessage += "Please check that the credit card has not expired and that the date is in the proper format, for example: 02 2004. ";
	}	
	if (!HideBillAndPIN && (document.card_pin.newpin.value !="") && (document.card_pin.confirmpin.value != "") && !ValidPIN(document.card_pin.newpin.value,document.card_pin.confirmpin.value)){
			top.errorMessage += "The PINs you typed in are incorrect. Please try typing them in again, making sure that they match and are only 4 numbers, for example: 1234. ";
		} 
	if (top.errorMessage != "") {
			top.SetPage('error.html');
	} else{
			document.card_pin.cardnumber.value = ccCardNumber;
			CardPinContinueButton();
	}
}
function SubmitCardInfo() {
  top.ccNum = document.card_pin.cardnumber.value;
  top.ccExpMonth = document.card_pin.expmonth.value;
  top.ccExpYear = document.card_pin.expyear.value;
  top.myWallet.setUserInfo("ccNum", top.ccNum);
  top.myWallet.setUserInfo("ccExpMonth", top.ccExpMonth);
  top.myWallet.setUserInfo("ccExpYear", top.ccExpYear);
  if (!HideBillAndPIN)
  {
    top.myWallet.setPIN(document.card_pin.confirmpin.value);
  }
}
function LoadCardInfo() {
  document.card_pin.cardnumber.value = top.ccNum;
  document.card_pin.expmonth.value = top.ccExpMonth;
  document.card_pin.expyear.value = top.ccExpYear;
}
function CardPinContinueButton() {
  SubmitCardInfo();
  if (HideBillAndPIN)
  {
    top.SetPage('review.html');
    return;
  }
  if (document.card_pin.billaddress.checked == false) {
    top.billFName=top.shipFName;
    top.billMI=top.shipMI;
    top.billLName=top.shipLName;
    top.billAddr1=top.shipAddr1;
    top.billAddr2=top.shipAddr2;
    top.billCity=top.shipCity;
    top.billState=top.shipState;
    top.billZip=top.shipZip;
    top.billCountry=top.shipCountry;
    top.myWallet.setUserInfo("billFName",top.billFName);
    top.myWallet.setUserInfo("billMI",top.billMI); 
    top.myWallet.setUserInfo("billLName",top.billLName);
    top.myWallet.setUserInfo("billAddr1",top.billAddr1);
    top.myWallet.setUserInfo("billAddr2",top.billAddr2);
    top.myWallet.setUserInfo("billCity",top.billCity);
    top.myWallet.setUserInfo("billState",top.billState);
    top.myWallet.setUserInfo("billZip",top.billZip);
    top.myWallet.setUserInfo("billCountry",top.billCountry);
    top.SetPage('review.html');
  } else {
    top.SetPage ('billing.html');
  }
}
</script>
<style type="text/css">
#MSNLogo {
	position: absolute;
	top: 7;
	left: 10;
	width: 87;
}
</style>
<body bgcolor=#21212e background="file://rom/tvimages/Pattern_TVSettings.gif" text=#cbcbcb link=#4489a8 hspace=0 vspace=0 fontsize=large onLoad="ChooseForm(); LoadCardInfo();">
<form name="card_pin">
<div id="Banner" style="position:absolute; top:0px; left:0px;">
<table cellspacing=0 cellpadding=0 cellborder=0>
	<tr><td background="file://rom/tvimages/ShadowLogo_Horizontal.gif" width=104 height=80 valign=top align=left>
			<spacer type=block WIDTH=11 HEIGHT=11><br>
			<spacer type=block WIDTH=10 HEIGHT=1>
	    	<a href="client:showtvhome"><div id=MSNLogo><img src="file://ROM/tvimages/WebTVPlusJewelLogo.gif" ></div></a>
	    <td width=456 height=80 valign=top align=center>
			<img src="file://rom/tvimages/TVSettingsBanner.gif" width=456 height=50><br>
			<img src="file://rom/tvimages/Shadow_Horizontal.gif" width=456 height=6>
</table>
</div>
<div id="Header" style="position:absolute; top:105px; left:60px;">
<font color=ffd069 size=+2><shadow>Credit card setup</shadow></font>
</div>
<div id="instruct_card" style="position:absolute; top:140px; left:60px; width:450;">
<font color=999999>Type in your credit card number and PIN.</font>
</div>
<div id="Lock" style="position:absolute; top:100px; left:470px;">
<img src="file://ROM/tvimages/WalletLock.gif">
</div>
<div id="CardInfo" style="position:absolute; top:165; left:60; width:500; visiblility:visible;">
<table border=0 cellspacing=0 cellpadding=0>
  <tr><td width=150 align=right height=33><font size=-1 color=6cb28b>Card Number:</font>
  <td width=7></td><td height=33 colspan=4><font color=ffcf69><input name="cardnumber" usestyle size=20 maxlength=19 selected border=1 bgcolor=000000></font>
  <tr><td width=70 align=right height=20><font size=-1 color=6cb28b><i>Example</i></font>
  <td width=7></td><td height=20 colspan=4><font size=-1 color=6cb28b><i>1234-5678-9012-3456</i></font>
</table>
</div>
<div id="ExpDate" style="position:absolute; top:220; left:60; width:500; visiblility:visible;">
<table border=0 cellspacing=0 cellpadding=0>
  <tr><td width=150 align=right height=33><font size=-1 color=6cb28b>Expiration Month:</font>
  <td width=7></td><td height=33><font color=ffcf69><input name="expmonth" usestyle size=2 maxlength=2 border=1 bgcolor=000000></font>
  <td width=150 align=right height=33><font size=-1 color=6cb28b>Expiration Year:</font>
  <td width=7></td><td height=33><font color=ffcf69><input name="expyear" usestyle size=4 maxlength=4 border=1 bgcolor=000000 onBlur="document.card_pin.expyear.value=validateYear(document.card_pin.expyear);"></font>
  <tr><td width=150 align=right height=20><font size=-1 color=6cb28b><i>Example</i></font>
  <td width=7></td><td height=20><font size=-1 color=6cb28b><i>06</i></font>
  <td width=150 align=right height=20><font size=-1 color=6cb28b><i>Example</i></font>
  <td width=7></td><td height=20><font size=-1 color=6cb28b><i>2004</i></font>
</table>
</div>
<div id="CheckboxPIN" style="position:absolute; top:275; left:60; width:500; visiblility:hidden;">
<table border=0 cellspacing=0 cellpadding=0>
  <tr><td><font size=-1 color=999999><input type=checkbox name="billaddress" value="notsame">Check the box if billing &amp mailing addresses are different</font></td></tr>
</table>
<hr>
<table border=0 cellspacing=0 cellpadding=0>
  <tr><td abswidth=160 align=right height=25><font size=-1 color=6cb28b>Type in &wtv-tvwallet; PIN:</font>
  <td abswidth=7>
  <td abswidth=20 height=25><font color=ffcf69><input type="password" name="newpin" usestyle size=6 maxlength=4 border=1  bgcolor=000000></font>
  <td abswidth=40>
  <td abswidth=160><font color=999999>Your PIN must</font>
  <tr><td width=160 align=right height=25><font size=-1 color=6cb28b>Re-type to confirm:</font>
  <td>
  <td height=25><font color=ffcf69><input type="password" name="confirmpin" usestyle size=6  maxlength=4 border=1 bgcolor=000000 nextright=cont nextdown=cont></font>
  <td>
  <td><font color=999999>be 4 numbers.</font>
</table>
</div>
<div id="Buttons" style="position:absolute; top:375; left:60;">
<table border=0 cellpadding=0 cellspacing=0>
  <tr><td><font size=-1 color=ffcf69><input type=button borderimage="file://ROM/tvimages/TVButtonBorder.bif" value="About Security" usestyle width=170 onClick="top.SetPage('faq.html')"></font>
  <td width=185>
  <td><font size=-1 color=ffcf69><input type=button borderimage="file://ROM/tvimages/TVButtonBorder.bif" id=cont value="Continue" usestyle width=130 onClick="CheckCardPinInput(this.form)" selected></font>
</table>
</div>
</form>
</body>
</html>
