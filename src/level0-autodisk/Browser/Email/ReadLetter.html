<html>

<script src=file://ROM/JS/parameters.js></script>

<head>
	<link href="CommonStyles.css" rel=Stylesheet>

	<script>
		var isOutgoing = parameters.folder.indexOf("Out") >= 0;
		window.message("isOutgoing: ", isOutgoing);
		window.message("parameters.folder: ", parameters.folder);
		var folderToUse = eval(parameters.folder);
		var msgIndex = parseInt(parameters.whichItem);

		if (!isOutgoing) {
			// Mark this letter as "read"
			top.MarkLetterRead(msgIndex, folderToUse);
		}

		function DiscardLetter(folder)
		{
			var L_Discard_Text = "Would you like to discard this message permanently?";
			if (confirmPriv(L_Discard_Text, top.gAlertIconURL, top.L_DiscardButton_Text, top.L_DontDiscardButton_Text)) {
				var letter = top.MailFolder_GetLetter(folderToUse, msgIndex);
				letter.setAttribute("deleted", "y");
				top.MailFolder_SaveLetter(folderToUse, msgIndex);
		//	top.DumpFolder(folderToUse, "before inbox");
		//	top.DumpFolder(top.gDeletedFolder, "before deleted");
				top.MailFolder_MoveLetter(folderToUse, msgIndex, top.gDeletedFolder);
		//	top.DumpFolder(folderToUse, "after inbox");
		//	top.DumpFolder(top.gDeletedFolder, "after deleted");

				location = "ListMail.html";
			}
		}

		function UnreadPreviousLetter(curIndex)
		{
			// Look to see if there are any letters before this one that are unread
			curIndex = parseInt(curIndex);	// force from string to a number
			var len = top.MailFolder_length(folderToUse);
			if (curIndex >= len)
				curIndex = len - 1;
			else if (curIndex < 0)
				curIndex = 0;

			return curIndex > 0;
		}

		function UnreadNextLetter(curIndex)
		{
			curIndex = parseInt(curIndex);	// force from string to a number
			var len = top.MailFolder_length(folderToUse);
			if (curIndex >= len)
				curIndex = len - 1;
			else if (curIndex < 0)
				curIndex = 0;

			return curIndex < len - 1;
		}

		function NextOrPreviousLetter(currentIndex, folder, nextLetter)
		{
			curIndex = parseInt(curIndex);	// force from string to a number
			var newIndex = nextLetter ? currentIndex + 1 : currentIndex - 1;

		window.message("****** currentIndex = ", currentIndex, " new index = ", newIndex);

			var maxIndex = top.MailFolder_length(folderToUse);
			if (newIndex >=0 && newIndex < maxIndex) {
				// only jump if there's a valid index
				var newLoc = "ReadLetter.html?whichItem=" + newIndex + "&maxcount=" + maxIndex + "&folder=top.gInFolder";
		window.message("setting new location to = \"", newLoc, '"');
				location = newLoc;
			}
		}
	</script>

</head>

<print blackandwhite>

<body
	text=42DB52
	link=189CD6
	vlink=189CD6
	vspace=0
	hspace=0
	bgcolor="172625">


<div id=sideBarBackground bgcolor=514971 gradcolor=1f2a30 gradangle=0>
</div>

<div id=sideBar>
	<script>
		var L_PreviousButton_Text = "Previous";
		var L_NextButton_Text = "Next";
		var L_ReplyButton_Text = "Reply";
		var L_ReplyAllButton_Text = "Reply all";
		var L_ForwardButton_Text = "Forward";

		top.beginSidebars(true);
		top.addSidebar(top.L_ListButton_Text, "ListMail.html", "MainFrameArea", "", true);

		top.addSidebar(L_PreviousButton_Text, "", "",
			'onClick="NextOrPreviousLetter(' + msgIndex + ', top.gInFolderStore, false)"', UnreadPreviousLetter(msgIndex));
		top.addSidebar(L_NextButton_Text, "", "",
			'onClick="NextOrPreviousLetter(' + msgIndex + ', top.gInFolderStore, true)"', UnreadNextLetter(msgIndex));
		top.addSidebar(top.L_DiscardButton_Text, "", "MainFrameArea", 'onClick="DiscardLetter(top.gInFolderStore);"', true)
		if (!isOutgoing) {
			top.addSidebar(L_ReplyButton_Text, "WriteLetter.html?cmd=reply&reply=show",
					"MainFrameArea", "", true)
			if (top.gCCMsg)
				top.addSidebar(L_ReplyAllButton_Text, "WriteLetter.html?cmd=replyall&reply=show",
						"MainFrameArea", "", true)
			top.addSidebar(L_ForwardButton_Text, "WriteLetter.html?cmd=forward&reply=show",
					"MainFrameArea", "", true)
		}
		top.addSidebar(top.L_HelpButton_Text, "Help.html", "MainFrameArea", "", true)
		top.endSidebars();
	</script>
</div>

<div id=scrollArea>
	<script>
		var m = '<IFRAME name=scrollingListArea SCROLLTARGET=YES SRC="ReadLetterScroll.html?folder='
				+ parameters.folder
				+ "&whichItem=" + parameters.whichItem
				+ '" HEIGHT=336 WIDTH=454 onscroll="top.refreshArrows()" frameborder=no></IFRAME>';
		document.write(m);
	</script>
</div>

<div id=upArrow>
	<img src=images/ScrollArrowUp.gif>
</div>

<div id=downArrow>
	<img src=images/ScrollArrowDown.gif>
</div>

<!--
<div id=sideBarSeparator>
	<img src=images/TransVertShadow.gif width=6 height=384>
</div>
-->

<div id=bannerAdBackground>
</div>

<div id=bannerAdDisplay>
	<script>
		top.WriteAd("epg-banner");
	</script>
</div>

<div id=bannerAdDivider>
	<table>
		<tr><td width=560 height=1 color=ffffff transparency=84></td></tr>
	</table>
</div>

</body>
</html>