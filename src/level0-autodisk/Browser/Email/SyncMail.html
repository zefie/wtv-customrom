<html>

<script src=file://ROM/JS/parameters.js></script>

<head>
	<link href="CommonStyles.css" rel=Stylesheet>

	<style>
	#progressBarSync {
		position: absolute;
		top: 175;
		left: 150;
		color:6cb18a;
	}
	.clsMessage {
		position: absolute;
		top: 200;
		left: 150;
		color: ffcf69;
	}
	#sendingMailText {
		visibility: hidden;
	}
	#receivingMailText {
		visibility: hidden;
	}
	#sendingAdrBook {
		visibility: hidden;
	}
	#receivingAdrBook {
		visibility: hidden;
	}
	#deletingMsgText {
		visibility: hidden;
	}
	#checkingMsgText {
		visibility: hidden;
	}
	#loadingMsgText {
		visibility: hidden;
	}
	</style>

	<title>Sync mail</title>

	<script>
		function StartSync()
		{
			window.message("Loaded SyncMail.html, now gonna sync");
			window.message("parameters.action = ", parameters.action);
			var niteSync = parameters.action == "niteSync";
			var result = top.Synchronize(!niteSync);
			var result = true;

			if (niteSync) {
				window.message("parameters.action == niteSync");
				// tell the browser we're all done
				var tv =  new TV;
				tv.endSync(!result);	//	-1 == cancel,  0 == ok
				window.message("done with tv.endSync = ", !result);
			} else {
				window.message("parameters.action != niteSync");
				if (parameters.reload == "true") {
					window.message("Calling LoadAllFolders");
					top.LoadAllFolders();
					window.message("Done calling LoadAllFolders");
				}
				if (parameters.action != "") {
					window.message("Going to ", parameters.action);
					location = parameters.action;
				} else {
					window.message("Going history.back");
					history.back();
				}
			}
		}
	</script>
</head>

<print blackandwhite>

<body bgcolor=172625 text="42BD52" link="189CD6"
	vlink="189CD6" fontsize="medium"
	vspace=0
	hspace=0>

<div id=sideBarBackground bgcolor=514971 gradcolor=1f2a30 gradangle=0>
</div>

<div id=sideBar>
	<script>
		top.beginSidebars(false);
		top.endSidebars();
	</script>
</div>

<!--
<div id=sideBarSeparator>
	<img src=images/TransVertShadow.gif width=6 height=384>
</div>
-->

<div id=progressBarSync>
	<progressindicator name=progBarSync message=" " textbelow height=44 width=300>
</div>

<div id=topBannerBackground bgcolor=0c1413 gradcolor=172625 gradangle=0>
</div>

<div id=topBanner>
	<img src=images/MailBanner.gif width=431 height=54>
</div>

<div id=pageTitleText>
	<shadow>Connect to offline e-mail</shadow>
</div>

<div class=clsMessage id=sendingMailText>
	Sending outgoing mail
</div>

<div class=clsMessage id=receivingMailText>
	Receiving new mail
</div>

<div class=clsMessage id=sendingAdrBook>
	Sending address book
</div>

<div class=clsMessage id=receivingAdrBook>
	Receiving address book
</div>

<div class=clsMessage id=deletingMsgText>
	Removing deleted messages
</div>

<div class=clsMessage id=checkingMsgText>
	Examining mail messages
</div>

<div class=clsMessage id=loadingMsgText>
	Putting mail in mailbox
</div>

	<script>
		window.message("Starting StartSync timeout");
		if (top.gRequest.visitedHomeYet())
			// set timeout doesn't seem to work during a datadownload
			var timeoutID = setTimeout("StartSync();", 1000);	// wait one second for the page to draw
		else
			StartSync();
		window.message("Finished StartSync timeout");
	</script>

</body>
</html>
